<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ground level plan</title>
  <style>
    body {
      margin: 0;
      background: white;
    }

    svg {
      width: 100%;
      height: auto;
      max-height: 297mm;
      display: block;
    }

    .grid25 {
      stroke: #99ccee;
      stroke-width: 0.01;
    }

    .grid100 {
      stroke: #3377bb;
      stroke-width: 0.03;
    }
  </style>
</head>
<body>
  <svg id="canvas" viewBox="0 0 11 9" xmlns="http://www.w3.org/2000/svg"></svg>

  <script>
    const svg = document.getElementById('canvas')
    const svgNS = svg.namespaceURI

    const gridSpacing = 0.25
    const maxX = 11
    const maxY = 9

    for (let x = 0; x <= maxX + 0.0001; x += gridSpacing ) {
      const line = document.createElementNS(svgNS, 'line')
      line.setAttribute('x1', x.toString())
      line.setAttribute('y1', '0')
      line.setAttribute('x2', x.toString())
      line.setAttribute('y2', maxY.toString())
      line.setAttribute('class', (Math.abs(x % 1) < 1e-6) ? 'grid100' : 'grid25')
      svg.appendChild(line)
    }

    for (let y = 0; y <= maxY + 0.0001; y += gridSpacing) {
      const line = document.createElementNS(svgNS, 'line')
      line.setAttribute('x1', '0')
      line.setAttribute('y1', y.toString())
      line.setAttribute('x2', maxX.toString())
      line.setAttribute('y2', y.toString())
      line.setAttribute('class', (Math.abs(y % 1) < 1e-6) ? 'grid100' : 'grid25')
      svg.appendChild(line)
    }

    function drawEllipse({ cx = 5.5, cy = 4.5, width, ratio, stroke, strokeWidth, opacity = 1 }) {
      const ellipse = document.createElementNS(svgNS, 'ellipse')
      ellipse.setAttribute('cx', cx)
      ellipse.setAttribute('cy', cy)
      ellipse.setAttribute('rx', width / 2)
      ellipse.setAttribute('ry', (width * ratio) / 2)
      ellipse.setAttribute('fill', 'none')
      ellipse.setAttribute('stroke', stroke)
      ellipse.setAttribute('stroke-width', strokeWidth)
      ellipse.setAttribute('stroke-opacity', 0.8)
      svg.appendChild(ellipse)
    }

    function drawEllipticalRacks({
      cx = 5.5, cy = 4.5,
      width,         // major axis length
      ratio,         // b / a (minor / major)
      offset = 0.1,  // how far from ellipse edge outward
      count = 16,
      length = 1.2,
      widthRack = 0.4,
      color = 'saddlebrown',
      opacity = 0.8,
      startAngle = 0
    }) {
      const a = width / 2
      const b = (width * ratio) / 2

      const deg2rad = angle => angle * Math.PI / 180
      const stepAngle = 360 / count

      for (let i = 0; i < count; i++) {
        const angleDeg = startAngle + i * stepAngle
        const angleRad = deg2rad(angleDeg)

        // unit direction from centre
        const ux = Math.cos(angleRad)
        const uy = Math.sin(angleRad)

        // point on ellipse boundary (parametric ellipse)
        const ex = a * ux
        const ey = b * uy

        // extend normal by offset
        const px = cx + ex + ux * offset
        const py = cy + ey + uy * offset

        const rect = document.createElementNS(svgNS, 'rect')
        rect.setAttribute('x', (-length / 2).toString())
        rect.setAttribute('y', (-widthRack / 2).toString())
        rect.setAttribute('width', length.toString())
        rect.setAttribute('height', widthRack.toString())
        rect.setAttribute('fill', color)
        rect.setAttribute('fill-opacity', opacity)
        rect.setAttribute('transform', `translate(${px}, ${py}) rotate(${angleDeg})`)
        svg.appendChild(rect)
      }
    }

function drawEllipticalSpiralRamp({
  cx = 5.5, cy = 4.5,
  width,
  ratio,
  rampWidth = 0.8,
  turns = 1,
  steps = 200,
  fill = '#d16c42',
  opacity = 0.6
}) {
  const aStart = width / 2
  const bStart = (width * ratio) / 2
  const aEnd = aStart - rampWidth
  const bEnd = bStart - rampWidth * ratio

  const outerPoints = []
  const innerPoints = []

  for (let i = 0; i <= steps; i++) {
    const t = i / steps
    const angle = 2 * Math.PI * turns * t

    const a = aStart - t * (aStart - aEnd)
    const b = bStart - t * (bStart - bEnd)

    const x = cx + a * Math.cos(angle)
    const y = cy + b * Math.sin(angle)
    outerPoints.push([x, y])
  }

  for (let i = steps; i >= 0; i--) {
    const t = i / steps
    const angle = 2 * Math.PI * turns * t

    const a = aStart - t * (aStart - aEnd)
    const b = bStart - t * (bStart - bEnd)

    const x = cx + (a - 0.0001) * Math.cos(angle)
    const y = cy + (b - 0.0001) * Math.sin(angle)
    innerPoints.push([x, y])
  }

  const d = [...outerPoints, ...innerPoints].map(
    (p, i) => (i === 0 ? 'M' : 'L') + p[0] + ' ' + p[1]
  ).join(' ') + ' Z'

  const path = document.createElementNS(svgNS, 'path')
  path.setAttribute('d', d)
  path.setAttribute('stroke', '#733')
  path.setAttribute('stroke-width', '0.80')
  path.setAttribute('stroke-opacity', '0.6')
  svg.appendChild(path)
}

    drawEllipse({width: 5, ratio: 3/5, stroke: '#e63946', strokeWidth: 0.3})
    drawEllipticalRacks({width: 6.8, ratio: 3.5/5, offset: 0.1, count: 16, length: 1.2, widthRack: 0.4})
    drawEllipticalSpiralRamp({width: 10, ratio: 4/5, stroke: '#888', rampWidth: 0.8})
  </script>

  <ul>
    <li><b>Dome:</b> vents just off the ground to suck air out of the storage and circulate it properly.</li>
    <li><b>Dome:</b> roof window to allow releasing the heat when one is inside and closing it for when we need to charge the structure with heat.</li>
    <li><b>Dome:</b> translucent glass (bottles or glass blocks) in the ceiling.</li>
    <li><b>Storage:</b> needs to be large to store all we need post-collapse.</li>
  </ul>
</body>
</html>
