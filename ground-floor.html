<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dome floor plan</title>
  <style>
    body {
      margin: 0;
      background: white;
    }

    svg {
      width: 100%;
      height: auto;
      max-height: 297mm;
      display: block;
      margin-bottom: 2rem;
    }

    .grid25 {
      stroke: #99ccee;
      stroke-width: 0.01;
    }

    .grid100 {
      stroke: #3377bb;
      stroke-width: 0.03;
    }
  </style>
</head>

<body>
  <h1>Underground pond</h1>
  <svg id="canvas-pond" viewBox="0 0 11 9" xmlns="http://www.w3.org/2000/svg"></svg>

  <h1>Ground floor</h1>
  <svg id="canvas-ground" viewBox="0 0 11 9" xmlns="http://www.w3.org/2000/svg"></svg>
  <ul>
    <li><b>Dome:</b> vents just off the ground to suck air out of the storage and circulate it properly.</li>
    <li><b>Dome:</b> roof window to allow releasing the heat when one is inside and closing it for when we need to charge the structure with heat.</li>
    <li><b>Dome:</b> translucent glass (bottles or glass blocks) in the ceiling.</li>
    <li><b>Storage:</b> needs to be large to store all we need post-collapse.</li>
  </ul>

  <h1>Upper levels</h1>
  <svg id="canvas-upper" viewBox="0 0 11 9" xmlns="http://www.w3.org/2000/svg"></svg>
  <ul>
    <li><b>Bedroom:</b> goes right above the dome, possibly suspended and covered by a woolen blanket.</li>
    PERHAPS DOME not dome after all, but rather with a wooden ceiling? but then it could be buffering somewhat poorly? Think it through well. Also, how about the glass blocks?
    expanded metal ring around, wooden floor above the dome
  </ul>

  <script>
    const gridSpacing = 0.25

    function showGrid(svg, maxX, maxY) {
      const svgNS = svg.namespaceURI
      for (let x = 0; x <= maxX + 0.0001; x += gridSpacing ) {
        const line = document.createElementNS(svgNS, 'line')
        line.setAttribute('x1', x)
        line.setAttribute('y1', 0)
        line.setAttribute('x2', x)
        line.setAttribute('y2', maxY)
        line.setAttribute('class', (Math.abs(x % 1) < 1e-6) ? 'grid100' : 'grid25')
        svg.appendChild(line)
      }

      for (let y = 0; y <= maxY + 0.0001; y += gridSpacing) {
        const line = document.createElementNS(svgNS, 'line')
        line.setAttribute('x1', 0)
        line.setAttribute('y1', y)
        line.setAttribute('x2', maxX)
        line.setAttribute('y2', y)
        line.setAttribute('class', (Math.abs(y % 1) < 1e-6) ? 'grid100' : 'grid25')
        svg.appendChild(line)
      }
    }

    function drawEllipse(svg, { cx, cy, width, ratio, stroke, strokeWidth, opacity = 0.8 }) {
      const ellipse = document.createElementNS(svg.namespaceURI, 'ellipse')
      ellipse.setAttribute('cx', cx)
      ellipse.setAttribute('cy', cy)
      ellipse.setAttribute('rx', width / 2)
      ellipse.setAttribute('ry', (width * ratio) / 2)
      ellipse.setAttribute('fill', 'none')
      ellipse.setAttribute('stroke', stroke)
      ellipse.setAttribute('stroke-width', strokeWidth)
      ellipse.setAttribute('stroke-opacity', opacity)
      svg.appendChild(ellipse)
    }

    function drawEllipticalRacks(svg, {
      cx, cy,
      width,            // major axis length
      ratio,            // b / a (minor / major)
      offset = 0.1,     // how far from ellipse edge outward
      count = 16,
      length = 1.2,
      widthRack = 0.4,
      color = 'saddlebrown',
      opacity = 0.8,
      startAngle = 0
    }) {
      const a = width / 2
      const b = (width * ratio) / 2

      const deg2rad = angle => angle * Math.PI / 180
      const stepAngle = 360 / count

      const svgNS = svg.namespaceURI

      for (let i = 0; i < count; i++) {
        const angleDeg = startAngle + i * stepAngle
        const angleRad = deg2rad(angleDeg)

        const ux = Math.cos(angleRad)
        const uy = Math.sin(angleRad)

        const ex = a * ux
        const ey = b * uy

        const px = cx + ex + ux * offset
        const py = cy + ey + uy * offset

        const rect = document.createElementNS(svgNS, 'rect')
        rect.setAttribute('x', (-length / 2).toString())
        rect.setAttribute('y', (-widthRack / 2).toString())
        rect.setAttribute('width', length.toString())
        rect.setAttribute('height', widthRack.toString())
        rect.setAttribute('fill', color)
        rect.setAttribute('fill-opacity', opacity)
        rect.setAttribute('transform', `translate(${px}, ${py}) rotate(${angleDeg})`)
        svg.appendChild(rect)
      }
    }

    function drawRect(svg, {
      cx, cy,
      width, height,
      rotation = 0,
      stroke = 'black',
      strokeWidth = 0.03,
      opacity = 0.8,
      rx = 0.3,            // horizontal corner radius
      ry = 0.3             // vertical corner radius
    }) {
      const rect = document.createElementNS(svg.namespaceURI, 'rect')
      rect.setAttribute('x', (-width / 2).toString())
      rect.setAttribute('y', (-height / 2).toString())
      rect.setAttribute('width', width.toString())
      rect.setAttribute('height', height.toString())
      rect.setAttribute('fill', 'none')
      rect.setAttribute('stroke', stroke)
      rect.setAttribute('stroke-width', strokeWidth.toString())
      rect.setAttribute('stroke-opacity', opacity.toString())
      rect.setAttribute('transform', `translate(${cx}, ${cy}) rotate(${rotation})`)
      if (rx > 0) rect.setAttribute('rx', rx.toString())
      if (ry > 0) rect.setAttribute('ry', ry.toString())
      svg.appendChild(rect)
    }

    function drawStaircase(svg, { cx, cy, stairTowerRatio = 3.5 / 5 }) {
      drawEllipse(svg, {cx, cy, width: 3.7, ratio: stairTowerRatio, stroke: '#888', strokeWidth: 0.50})
      drawEllipse(svg, {cx, cy, width: 1, ratio: stairTowerRatio, stroke: 'dodgerblue', strokeWidth: 0.50})
      drawEllipticalRacks(svg, {cx, cy, width: 2.3, ratio: stairTowerRatio, offset: 0.1, count: 16, length: 0.80, widthRack: 0.3})
    }

    function drawBananaPlant(svg, {cx, cy}) {
      drawEllipticalRacks(svg, {cx, cy, width: 0.1, ratio: 1, color: 'green', count: 7})
    }

    // Set up canvases
    const pond = document.getElementById('canvas-pond')
    const ground = document.getElementById('canvas-ground')
    const upper = document.getElementById('canvas-upper')

    showGrid(pond, 11, 9)
    showGrid(ground, 11, 9)
    showGrid(upper, 11, 9)

    const centreX = 5.5 // doesn't change
    const centreY = 5.8

    /* Ground floor */
    drawEllipse(ground, {cx: centreX, cy: centreY, width: 5, ratio: 3/5, stroke: '#e63946', strokeWidth: 0.3})
    drawEllipse(ground, {cx: centreX, cy: centreY, width: 8.2, ratio: 3.5/5, stroke: '#888', strokeWidth: 0.50})
    drawEllipticalRacks(ground, {cx: centreX, cy: centreY, width: 6.3, ratio: 3.25/5, offset: 0.1, count: 16, length:
0.80, widthRack: 0.4})
    drawStaircase(ground, {cx: centreX, cy: 1.7})

    /* Upper floor */
    drawEllipse(upper, {cx: centreX, cy: centreY, width: 5, ratio: 3/5, stroke: '#e63946', strokeWidth: 0.1})
    drawEllipse(upper, {cx: centreX, cy: centreY, width: 8.2, ratio: 3.5/5, stroke: '#888', strokeWidth: 0.50})
    drawBananaPlant(upper, {cx: centreX - 3, cy: centreY})
    drawBananaPlant(upper, {cx: centreX + 3, cy: centreY})

    drawBananaPlant(upper, {cx: centreX - 2.3, cy: centreY - 1.4})
    drawBananaPlant(upper, {cx: centreX + 2.3, cy: centreY + 1.4})

    drawBananaPlant(upper, {cx: centreX - 2.3, cy: centreY + 1.4})
    drawBananaPlant(upper, {cx: centreX + 2.3, cy: centreY - 1.4})

    drawBananaPlant(upper, {cx: centreX - 0.8, cy: centreY - 2})
    drawBananaPlant(upper, {cx: centreX + 0.8, cy: centreY + 2})

    drawBananaPlant(upper, {cx: centreX - 0.8, cy: centreY + 2})
    drawBananaPlant(upper, {cx: centreX + 0.8, cy: centreY - 2})

    drawStaircase(upper, {cx: centreX, cy: 1.7})
    drawRect(upper, {cx: 8.7, cy: 2.5, width: 3, height: 2, strokeWidth: 0.50, stroke: "#888", rotation: 25})
    drawRect(upper, {cx: 2.2, cy: 2.5, width: 3, height: 2, strokeWidth: 0.50, stroke: "#888", rotation: -25})
  </script>
</body>
</html>
